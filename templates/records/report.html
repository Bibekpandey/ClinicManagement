{% load staticfiles %}

<!DOCTYPE html>

<html>

<head>
    <title> REPORT DISPLAY </title>
</head>

<body onload="load()">
    <h2> {{ name }} </h2>
    <h2> {{ contact }} </h2>

    <form name = "report" method="post" action="{% url 'report_detail' %}">
    {% csrf_token %}
        <input id="hidden_name_id" type="hidden" name="name" value="-1" />
        <input id="hidden_contact_id" type="hidden" name="contact" value="-1" />
        <input id="hidden_date_id" type="hidden" name="date" value = "-1" />
        <input id="hidden_visit_id" type="hidden" name="id" value="-1" />
    {% for visit in visits %}
    <div id="visit_{{forloop.counter}}">
        <a href="#" onclick="toggletests({{forloop.counter}});">{{ visit.date }}</a><br>
        <div class="tests" id="tests_{{forloop.counter}}">
            <ul>
                {% for tests in alltests %}
                    {% if forloop.parentloop.counter == forloop.counter %}
                        {% for test in tests %}
                        <li><a href="{% url 'report_detail'%}?testid={{test.id}}"> {{test}} </a></li>
                        {% endfor %}
                    {% endif %}
                {% endfor %}
            </ul>
        </div>
    </div>
    {% endfor %}


</body>

<script>
function submitform(name, contact, visitid)
{
    var hiddenname = document.getElementById("hidden_name_id");
    var hiddencontact = document.getElementById("hidden_contact_id");
    var hiddenvisitid = document.getElementById("hidden_visit_id");

    hiddenname.value = name;
    hiddencontact.value = contact;
    hiddenvisitid.value = visitid;
    
    var forms = document.getElementsByTagName('form');
    var form = forms[0];
    form.submit();
    // not adding alert() returns back here. Don't know what is going on here
}

function toggletests(id)
{
    var elem = document.getElementById("tests_"+id.toString());
    var attr= elem.style.display;
    if(attr=="none")
        elem.style.display = "block";
    else elem.style.display="none";
}

function load()
{
    var elems = document.getElementsByClassName("tests");
    for (x in elems)
        elems[x].style.display="none";
}

</script>

</html>
